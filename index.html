<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Upload your MP3</title>
    <script type="text/javascript" src="https://rawgit.com/fastest963/JavaScript-ID3-Reader/master/src/id3.js"></script>
</head>
<body>

<p><input id="upload" type="file" accept="audio/*"></p>

<p><input type="text" id="num-kb" value="16" size="3"> kilobytes to load</p>

<p><input type="text" id="num-frames" value="25" size="3"> frames to inspect</p>

<p id="results"></p>

<script type="text/javascript">

    function showResults(result) {
        document.getElementById('results').innerHTML = result;
    }

    document.getElementById('upload').onchange = function(ev) {
        var el = ev.currentTarget,
                files = ev.target.files,
                start, file;

        if (!files && el.value) {
            //create a fake object for IE9
            files = [{name: el.value, type: ''}];
        } else if (!files || !files.length) {
            showResults('No files uploaded');
            return;
        }
        file = files[0];
        if (!file || !file.name) {
            showResults('Invalid file uploaded');
            return;
        }
        if (file.type && file.type !== "audio/mp3" && file.type !== "audio/mpeg") {
            showResults('Filetype ' + file.type + ' not supported');
            return;
        }

        if (window.performance) {
            start = window.performance.now();
        } else {
            start = +(new Date())
        }
        showResults('Processing...');
        ID3.loadTags({
            file: file,
            tags: {title: 1, artist: 1, album: 1, track: 1, year: 1},
            bytesToRead: (+document.getElementById('num-kb').value) * 1024,
            maxFrames: +document.getElementById('num-frames').value,
            success: function(metadata) {
                el.value = '';
                console.log(metadata);
                var sampleRate = metadata.sampleRate || 'unknown',
                        bitRate = metadata.bitRate || 'unknown',
                        frames = metadata.framesInspected || '0',
                        result = [], end;
                result.push('Sample Rate: ' + sampleRate);
                result.push('Bitrate: ' + bitRate);
                result.push('# Frames Inspected: ' + frames);
                if (window.performance) {
                    end = window.performance.now();
                } else {
                    end = +(new Date())
                }
                result.push('Took ms: ' + (end - start));
                showResults(result.join('<br />'));
            },
            error: function(error) {
                el.value = '';
                if (error === 'readerror') {
                    showResults('Error reading file.');
                } else if (error) {
                    showResults('Error: ' + error);
                } else {
                    showResults('Unknown error. Please send/post mp3 for inspection. Check console for errors.');
                }
            }
        });
    };
</script>

</body>
</html>